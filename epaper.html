<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NewsWave ‚Äî Epaper Edition</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="preload" href="style.css" as="style" />
  <link rel="stylesheet" href="style.css" />
  <style>
    body { background:#f5f7fa; color:#333; font-family:Arial, sans-serif; }
    h2 { margin-bottom:6px; color:#111827; }
    p.desc { color:#6b7280; font-size:14px; }
    .epaper-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(350px,1fr));
      gap:20px;
      margin-top:20px;
    }
    .epaper-card {
      background:white;
      border-radius:12px;
      box-shadow:0 4px 14px rgba(0,0,0,0.1);
      overflow:hidden;
      border:1px solid #e5e7eb;
    }
    .epaper-card img {
      width:100%;
      height:200px;
      object-fit:cover;
      display:block;
    }
    .epaper-content {
      padding:15px;
    }
    .epaper-card h3 {
      margin:0 0 10px 0;
      font-size:18px;
      color:#111827;
    }
    .epaper-card p {
      margin:0 0 10px 0;
      font-size:14px;
      color:#6b7280;
      line-height:1.5;
    }
    .news-source {
      color:#ef4444;
      font-size:12px;
      font-weight:bold;
      text-transform:uppercase;
    }
    .news-date {
      color:#9ca3af;
      font-size:12px;
      margin-bottom:10px;
    }
    .loading {
      text-align: center;
      padding: 20px;
      font-size: 16px;
      color: #6b7280;
    }
  </style>
</head>

<body>
  <div id="header"></div>
  <script>
    fetch("header.html").then(r=>r.text()).then(h=>document.getElementById("header").innerHTML=h);
  </script>

  <main class="container" style="margin:20px 0;">
    <h2>üì∞ Epaper Edition - Latest News</h2>
    <p class="desc">Curated news stories with images and detailed information from top Telugu news sources</p>
    
    <div style="text-align: center; margin: 20px 0;">
      <a href="submit-news.html" style="display: inline-block; background: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold;">
        ‚úçÔ∏è Submit News Article
      </a>
    </div>

    <div class="epaper-grid" id="epaperGrid">
      <div class="loading">Loading news articles...</div>
    </div>
  </main>

  <div id="footer"></div>
  <script>
    fetch("footer.html").then(r=>r.text()).then(h=>document.getElementById("footer").innerHTML=h);
  </script>

  <script>
    const API_BASE = ""; // Updated to unified server

    async function loadNews() {
      const grid = document.getElementById("epaperGrid");
      
      try {
        const response = await fetch('/api/news');
        const articles = await response.json();
        
        if (articles && articles.length > 0) {
          grid.innerHTML = articles.slice(0, 12).map(article => `
            <div class="epaper-card">
              ${article.image_url ? `<img src="${article.image_url}" alt="${article.title}" onerror="this.onerror=null;this.src='https://placehold.co/350x200?text=No+Image';" onclick="openArticle('${encodeURIComponent(article.link || '')}', 'epaper', '${encodeURIComponent(article.title || '')}'); return false;">` : `<img src="https://placehold.co/350x200?text=No+Image" alt="No image available" onclick="openArticle('${encodeURIComponent(article.link || '')}', 'epaper', '${encodeURIComponent(article.title || '')}'); return false;">`}
              <div class="epaper-content">
                <div class="news-source">${article.source || 'News Source'}</div>
                <h3>${article.title}</h3>
                <div class="news-date">${formatDate(article.pubDate)}</div>
                <p>${truncateText(article.summary, 150)}</p>
                <a href="#" onclick="openArticle('${encodeURIComponent(article.link || '')}', 'epaper', '${encodeURIComponent(article.title || '')}'); return false;" style="color:#3b82f6; text-decoration:none; font-weight:bold;">Read Full Story ‚Üí</a>
              </div>
            </div>
          `).join("");
        } else {
          // Fallback to sample news data if API fails
          loadSampleNews(grid);
        }
      } catch (error) {
        console.error('Error loading news:', error);
        // Fallback to sample news data if API fails
        loadSampleNews(grid);
      }
    }
    
    function loadSampleNews(grid) {
      // Sample news data to display when API is unavailable
      const sampleArticles = [
        {
          title: "Global Economic Summit Addresses Financial Recovery Strategies",
          summary: "World leaders convene at the annual economic summit to discuss strategies for global financial recovery and sustainable growth initiatives.",
          source: "Financial Times",
          pubDate: new Date().toISOString(),
          link: "#",
          image_url: "https://images.unsplash.com/photo-1542705819-a0fef6062fd2?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
        },
        {
          title: "Technology Innovation Conference Showcases Future Trends",
          summary: "Major technology companies reveal breakthrough innovations and emerging trends that will shape the industry for years to come.",
          source: "Tech Review",
          pubDate: new Date(Date.now() - 86400000).toISOString(),
          link: "#",
          image_url: "https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
        },
        {
          title: "Film Industry Celebrates Outstanding Achievements at Annual Awards",
          summary: "The film industry honors exceptional talent and creativity at the prestigious annual awards ceremony with major stars in attendance.",
          source: "Entertainment Weekly",
          pubDate: new Date(Date.now() - 172800000).toISOString(),
          link: "#",
          image_url: "https://images.unsplash.com/photo-1536396123456-18ceecb6d246?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
        },
        {
          title: "Championship Finals Deliver Record Viewership Numbers",
          summary: "The championship finals break viewership records as teams compete in an exciting match that captivates audiences worldwide.",
          source: "Sports Network",
          pubDate: new Date(Date.now() - 259200000).toISOString(),
          link: "#",
          image_url: "https://images.unsplash.com/photo-1541252260730-0412e8e2108e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
        }
      ];
      
      grid.innerHTML = sampleArticles.map(article => `
        <div class="epaper-card">
          <img src="${article.image_url}" alt="${article.title}" onerror="this.onerror=null;this.src='https://placehold.co/350x200?text=No+Image';" onclick="openArticle('${encodeURIComponent(article.link || '')}', 'epaper', '${encodeURIComponent(article.title || '')}'); return false;">
          <div class="epaper-content">
            <div class="news-source">${article.source}</div>
            <h3>${article.title}</h3>
            <div class="news-date">${formatDate(article.pubDate)}</div>
            <p>${truncateText(article.summary, 150)}</p>
            <a href="${article.link}" style="color:#3b82f6; text-decoration:none; font-weight:bold;">Read Full Story ‚Üí</a>
          </div>
        </div>
      `).join("");
    }
    
    function formatDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
    }
    
    function truncateText(text, maxLength) {
      if (!text) return 'No summary available.';
      return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
    }

    function openArticle(link, category, title) {
      // Use the title as the article ID since links may not be reliable
      const articleId = title ? encodeURIComponent(title.substring(0, 50)) : encodeURIComponent(link);
      window.location.href = `article.html?id=${articleId}&category=${category}`;
    }

    // Load news when page loads
    document.addEventListener('DOMContentLoaded', loadNews);
  
  </script>
</body>
